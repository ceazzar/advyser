ADVYSER VALIDATED PRODUCTION READINESS AUDIT
=============================================
Date:     2026-02-12
Sources:  Production Readiness Audit (6-team) + Codex MVP1 Release Audit
Method:   Every finding validated against actual codebase
Verdict:  NOT READY FOR PUBLIC RELEASE

Execution Status Update (2026-02-12):
  - MVP1 remediation plan has been implemented in code.
  - See execution evidence: plans/MVP1_REMEDIATION_EXECUTION_REPORT_2026-02-12.md
  - Post-remediation gate status: READY FOR MVP1 DIRECT LAUNCH (code/test evidence),
    subject to legal/process approvals.


=============================================
TABLE OF CONTENTS
=============================================

  1. Executive Summary
  2. Validation Methodology
  3. Confirmed Critical Blockers
  4. Confirmed High-Priority Issues
  5. Confirmed Medium Issues
  6. Confirmed Low Issues
  7. False Positives (Rejected Findings)
  8. Positive Findings (What's Done Well)
  9. Remediation Roadmap
  10. Deferred Issues (Auth-Only, Out of MVP1 Scope)
  11. Source Coverage Reconciliation (All Source Audit Items Accounted For)


=============================================
1. EXECUTIVE SUMMARY
=============================================

Two independent audits were conducted. This document merges both,
removes duplicates, corrects false positives, and validates every
finding against the actual source code.

The application is a financial advisor marketplace for Australia
built on Next.js 16 + Supabase + Shadcn UI + Tailwind 4.

Current state: public-only brochure + search + lead form.
All auth routes (login, signup, dashboard, admin) are intentionally
disabled via middleware for MVP1 scope.

MVP1 scope: 19 public routes + 3 public API endpoints.
Auth-only issues are documented but deferred to Section 10.

Validated issue counts by severity (MVP1 scope only):

  CRITICAL:  13 issues  (legal risk, security, a11y, broken UX)
  HIGH:      14 issues  (missing validation, no tests, infra gaps)
  MEDIUM:    16 issues  (performance, consistency, partial features)
  LOW:       15 issues  (code quality, polish)
  DEFERRED:  10 issues  (auth-only, out of MVP1 scope)
  REJECTED:   5 findings (false positives from original audits)
  PASS:      25+ items done well


=============================================
2. VALIDATION METHODOLOGY
=============================================

Four parallel validation agents reviewed source files for every
finding. Each claim was checked against:
  - Actual file content and line numbers
  - Package.json dependencies
  - Directory structure (route existence)
  - Code behavior (not just presence)

Verdicts: CONFIRMED, PARTIALLY CORRECT, FALSE POSITIVE


=============================================
3. CONFIRMED CRITICAL BLOCKERS (13 issues)
=============================================

Must fix before any public launch. All items scoped to MVP1
public-only routes and endpoints.

----------------------------------------------------------------------
LEGAL / TRUST (7 issues)
----------------------------------------------------------------------

CRT-01: Fake Testimonials with Dollar Amounts
  Status:   CONFIRMED
  Files:    site/src/app/page.tsx:85-116
  Evidence: "Sarah Mitchell" saved "$4,200/yr", "Michael Chen"
            saved "$12,000", "Emma Thompson" retired "5 years
            earlier". All hardcoded mock objects.
  Risk:     Violates Australian Consumer Law (ACL) Section 18 -
            misleading or deceptive conduct. Specific dollar
            amounts on fabricated outcomes are especially risky.
  Fix:      Remove entirely or replace with real, verified data.

CRT-02: Fabricated Platform Statistics
  Status:   CONFIRMED (with inconsistency)
  Files:    site/src/app/page.tsx:371 (clientCount={75000})
            site/src/app/for-advisors/page.tsx:37-40
  Evidence: "75,000+ consumers", "2,500+ verified advisors",
            "92% client satisfaction". All hardcoded. No backend
            data source. The platform has zero real users.
  Risk:     Misleading advertising under ACL.
  Fix:      Remove or replace with honest language ("launching
            soon", "growing network").

CRT-03: ASIC Verification Claim Without System
  Status:   CONFIRMED
  Files:    site/src/app/page.tsx:128
            site/src/components/composite/trust-strip.tsx:133
  Evidence: "ASIC-verified advisors" badge, "ASIC Regulated"
            security badge. No automated ASIC lookup, no admin
            verification workflow exists.
  Risk:     Claiming regulatory verification that doesn't exist.
  Fix:      Soften to "advisors hold their own AFSL" (which the
            footer already correctly states).

CRT-04: Placeholder ABN
  Status:   CONFIRMED (3 locations)
  Files:    site/src/components/layout/public-footer.tsx:204
            site/src/app/contact/page.tsx:250
            site/src/app/privacy/page.tsx:40
  Evidence: "ABN: XX XXX XXX XXX" in all three files.
  Risk:     Australian businesses must display a real ABN.
  Fix:      Replace with actual registered ABN.

CRT-05: Placeholder Contact Details
  Status:   CONFIRMED
  Files:    site/src/app/contact/page.tsx
            site/src/app/help/page.tsx
            site/src/app/privacy/page.tsx
            site/src/app/cookies/page.tsx
            site/src/app/terms/page.tsx
  Evidence: Phone "1300 123 456", address "Level 10, 123 George
            Street" scattered across legal pages. If fake, users
            cannot exercise privacy rights under Privacy Act 1988.
  Fix:      Replace with real contact details or remove.

CRT-06: Legal Sign-Off Status Pending
  Status:   CONFIRMED
  Files:    docs/legal-review-request:28, :51, :72
  Evidence: All legal disclaimers marked "DRAFT - PENDING LEGAL
            APPROVAL". ABN, company legal name, and AFSL status
            all listed as PENDING in the legal review template.
            No sign-off recorded.
  Risk:     Launching with unreviewed legal language on a financial
            services platform creates regulatory exposure.
  Fix:      Complete legal review and obtain sign-off before launch.

CRT-07: "Featured in: Forbes, WSJ, Bloomberg" Placeholders
  Status:   CONFIRMED
  Files:    site/src/components/composite/trust-strip.tsx:152-154
  Evidence: <PartnerLogoPlaceholder name="Forbes" /> etc.
            Fabricated media trust signals.
  Fix:      Remove entirely until real press coverage exists.

----------------------------------------------------------------------
SECURITY (2 issues)
----------------------------------------------------------------------

CRT-08: Rate Limiting Fail-Open (Packages Missing)
  Status:   CONFIRMED
  Files:    site/src/lib/ratelimit.ts:112-125
            site/package.json (missing @upstash/*)
  Evidence: When limiter is unavailable, returns { success: true }.
            @upstash/ratelimit and @upstash/redis are NOT in
            package.json. Rate limiting is completely non-functional.
  Risk:     Lead spam, brute force attacks, resource exhaustion.
  Fix:      Install packages + configure Upstash, or add in-memory
            fallback. Set RATE_LIMIT_STRICT=true for production.

CRT-09: Listings API Crashes on Crafted Query Input
  Status:   CONFIRMED
  Files:    site/src/app/api/listings/route.ts:171-173
  Evidence: User query interpolated into .or() PostgREST filter:
              `headline.ilike.%${query}%,bio.ilike.%${query}%`
            Commas/dots in query cause malformed filter syntax,
            resulting in 500 error. Codex audit confirmed:
            GET /api/listings?q=a,b returns 500.
  Note:     NOT a data-exposure injection (outer WHERE filters
            still apply). IS a denial-of-service/crash vector
            on the core search endpoint.
  Fix:      Sanitize query to strip PostgREST metacharacters
            (commas, dots, parens) or use individual .ilike()
            calls on each column.

----------------------------------------------------------------------
UX / ROUTES (3 issues)
----------------------------------------------------------------------

CRT-10: Dead Links to Pruned Routes
  Status:   CONFIRMED
  Files:    site/src/app/for-advisors/page.tsx:249, 487
            site/src/app/help/page.tsx:31, 48
  Evidence: Multiple CTAs link to /signup?type=advisor and /claim.
            Middleware redirects both to /. Users hit confusing
            redirect loop.
  Fix:      Replace with mailto:, waitlist form, or remove CTAs.

CRT-11: Contact Form is Fake
  Status:   CONFIRMED
  Files:    site/src/app/contact/page.tsx:72
  Evidence: handleSubmit uses setTimeout(1500ms) then shows
            "Message sent!" - no backend call, no email sent.
  Fix:      Wire to API endpoint or email service, or hide form
            and show "Email us at support@advyser.com.au".

CRT-12: DM Sans Font Never Loaded
  Status:   CONFIRMED
  Files:    site/src/app/globals.css:22 (declares --font-dm-sans)
            site/src/app/layout.tsx (no font import)
  Evidence: CSS references "DM Sans" font family but no
            next/font/google import, no @font-face, no CDN link.
            Every user sees system fallback fonts.
  Fix:      Add next/font/google import for DM Sans in layout.tsx.

----------------------------------------------------------------------
ACCESSIBILITY (1 compound issue)
----------------------------------------------------------------------

CRT-13: Critical/Serious Accessibility Failures on MVP1 Routes
  Status:   CONFIRMED
  Sources:  Codex automated scans on /, /search, /request-intro
  Evidence:
    Critical violations:
      - button-name: buttons without accessible names
      - aria-allowed-attr: invalid ARIA attributes
    Serious violations:
      - aria-input-field-name: inputs without labels
      - color-contrast: insufficient contrast ratios
      - link distinguishability: links not visually distinct
    Code-level issues:
      - Invalid combobox ARIA in hero-search-bar.tsx:372, :449
        (role="combobox" with aria-haspopup="listbox" pattern
        does not fully follow WAI-ARIA combobox specification)
      - Duplicate/nested <main> landmarks:
        layout.tsx:21 has <main id="main-content">
        public-layout.tsx:14 has <main className="flex-1">
        HTML spec allows only one <main> per document.
  Fix:      Run axe-core on all 19 MVP1 routes. Fix critical and
            serious violations. Remove nested <main> from one of
            the two layouts.


=============================================
4. CONFIRMED HIGH-PRIORITY ISSUES (14 issues)
=============================================

Should fix before launch. Auth-only items moved to Section 10.

----------------------------------------------------------------------
SECURITY
----------------------------------------------------------------------

HI-01: Zod Schemas Defined But Unused in API Routes
  Status:   CONFIRMED
  Evidence: 13 Zod schemas in lib/schemas.ts. Zero imports in
            any API route handler. Request bodies destructured
            without validation.
  Fix:      Apply schemas to validate request.json() in handlers.

HI-02: No UUID Validation on Path Parameters
  Status:   CONFIRMED
  Evidence: All [id]/route.ts files pass id directly to Supabase
            without format validation. Invalid UUIDs cause 500s.
  Fix:      Validate against UUID regex before DB query.

HI-03: CSP Weaknesses
  Status:   CONFIRMED
  Files:    site/next.config.ts
  Evidence: script-src includes unsafe-inline. connect-src allows
            any HTTPS origin via wildcard.
  Fix:      Tighten to nonce-based CSP. Restrict connect-src to
            *.supabase.co.

----------------------------------------------------------------------
BACKEND
----------------------------------------------------------------------

HI-04: No Caching Headers on Any API Route
  Status:   CONFIRMED
  Evidence: Checked all 16 route files. Zero Cache-Control
            headers. Every request hits the database.
  Fix:      Add Cache-Control for public listing/search routes.

HI-05: Guest Lead Creates Orphan Users
  Status:   CONFIRMED
  Files:    site/src/app/api/leads/route.ts:339-368
  Evidence: Creates public.users row without auth.users entry.
            No auth credentials, cannot log in. Later signup
            with same email hits unique constraint.
  Fix:      Use email-only lead tracking without creating user.

HI-06: Generated Types Underutilized
  Status:   PARTIALLY CORRECT
  Files:    site/src/types/database.generated.ts
  Evidence: File exists and is imported for client typing, but
            routes use `as unknown as { ... }` casts (36
            instances). Compile-time type safety not leveraged.
  Fix:      Type Supabase queries with generated types.

----------------------------------------------------------------------
INFRASTRUCTURE
----------------------------------------------------------------------

HI-07: No robots.txt
  Status:   CONFIRMED
  Fix:      Create site/src/app/robots.ts

HI-08: No sitemap.xml
  Status:   CONFIRMED
  Fix:      Create site/src/app/sitemap.ts

HI-09: No Error Tracking (Sentry)
  Status:   CONFIRMED
  Evidence: Zero references to Sentry in codebase.
  Fix:      Install @sentry/nextjs.

HI-10: Zero API Route Tests
  Status:   CONFIRMED
  Evidence: 9 test files exist (all UI component + utility tests).
            Zero tests in site/src/app/api/.
  Fix:      Write integration tests for critical routes.

HI-11: Zero E2E Tests
  Status:   CONFIRMED
  Evidence: Playwright configured. e2e/tests/ contains only
            .gitkeep. Auth setup file exists but no test specs.
  Fix:      Write E2E tests for search + lead submission flow.

HI-12: No OpenGraph / SEO Metadata
  Status:   CONFIRMED
  Files:    site/src/app/layout.tsx
  Evidence: Only title + description in metadata. No og:image,
            no per-page metadata, no structured data.
  Fix:      Add metadataBase, OpenGraph tags, JSON-LD.

HI-13: pg in Production Dependencies
  Status:   CONFIRMED
  Files:    site/package.json:73
  Evidence: "pg": "^8.18.0" in dependencies. Only used by dev
            scripts, not by the Next.js app at runtime.
  Fix:      Move to devDependencies.

HI-14: No Cookie Consent Banner
  Status:   CONFIRMED
  Evidence: Cookie policy page exists but no consent mechanism
            in the UI. GDPR/APP compliance gap.
  Fix:      Add cookie consent component.


=============================================
5. CONFIRMED MEDIUM ISSUES (16 issues)
=============================================

Address before or shortly after launch. Auth-only items moved
to Section 10. Accessibility items (formerly MED-10, MED-11)
consolidated into CRT-13.

MED-01: Middleware Blocks All Auth Routes (Intentional for MVP1)
  Status:   CONFIRMED (intentional)
  Files:    site/src/middleware.ts:4-17
  Note:     By design for MVP1 public-only scope. Not a bug,
            but documented here as it blocks login/signup/
            dashboard functionality.

MED-02: Post-Query Filtering Breaks Pagination
  Files:    site/src/app/api/listings/route.ts:216-237
  Evidence: Specialty/state/postcode filters applied AFTER DB
            query. Pagination counts are incorrect.

MED-03: Newsletter Form Does Nothing
  Files:    site/src/app/resources/page.tsx:420-429
  Evidence: No onSubmit handler on newsletter subscription form.

MED-04: Resources Page Article Links are 404s
  Evidence: All 12 article links point to non-existent routes.

MED-05: Press Page Buttons Non-Functional
  Evidence: "Read More", "External Link", "Download" all do nothing.

MED-06: Category Page Filters Decorative
  Evidence: Filter dropdowns not wired to API. Load More broken.

MED-07: Help Page Search Non-Functional
  Evidence: Search bar has no functionality.

MED-08: Advisor Resources Links are Placeholders
  Evidence: All href="#" placeholders. Download buttons do nothing.

MED-09: Map View "Coming Soon" Placeholder in Search
  Files:    site/src/app/search/page.tsx:312, 1021
  Evidence: Map toggle visible but renders placeholder.
  Fix:      Hide toggle or add map view.

MED-10: Fabricated Statistics Inconsistent
  Evidence: Homepage: 75,000 consumers. About: 50,000+.
            For Advisors: 2,500+ advisors vs 10,000+.
            Different numbers on different pages.

MED-11: Category Taxonomy Inconsistency
  Evidence: Four incompatible taxonomy systems across homepage,
            search, quiz, and database schema.

MED-12: No CAPTCHA on Public Lead Submission
  Files:    site/src/app/api/leads/route.ts

MED-13: No CSRF Protection on API Routes
  Evidence: No CSRF tokens or Origin/Referer checking.

MED-14: Error Messages Expose Implementation Details
  Evidence: Raw Supabase errors returned to clients in some routes.

MED-15: Package Name Mismatch
  Files:    site/package.json:2
  Evidence: Package named "frontend" but directory is site/.

MED-16: CI Test Instability
  Evidence: Codex audit found npm run verify:ci fails with
            LRUCache constructor error from @asamuzakjp/css-color.
  Note:     May be a transient dependency issue.


=============================================
6. CONFIRMED LOW ISSUES (15 issues)
=============================================

Nice to have. Fix when convenient.

LOW-01: HSTS Without preload Directive
LOW-02: X-XSS-Protection Header is Deprecated (should remove)
LOW-03: Non-null Assertions on Env Vars (4 files)
LOW-04: Dynamic require Pattern in Rate Limiter
LOW-05: "John Doe" Default in Consumer Header
LOW-06: Deprecated Components Log Warnings in Production
LOW-07: Admin "Log Out" Just Navigates (no session clear)
LOW-08: Hardcoded Mock Advisor Counts in Hero Search
LOW-09: "Mock data" Comment in Homepage Source
LOW-10: Social Media Links May Not Exist
LOW-11: Quiz Page Has No Header/Footer
LOW-12: /request-intro Without listingId Shows Error
LOW-13: No Prettier Config or Import Ordering
LOW-14: No Pre-Commit Hooks (Husky/lint-staged)
LOW-15: poweredByHeader Not Disabled in next.config


=============================================
7. FALSE POSITIVES (Rejected Findings)
=============================================

These findings from the original audits were validated as
incorrect or mischaracterized.

----------------------------------------------------------------------

FP-01: SEC-C03 "Admin Client on Public Endpoint" (Audit 1)
  Original Claim: GET /api/listings/[id] uses admin client to
                  bypass all RLS on a public endpoint.
  Actual Code:    The initial listing query (line 138) uses the
                  REGULAR Supabase client (RLS-enforced). Admin
                  client is only used AFTER the listing is fetched
                  to query related credential/qualification tables.
                  This is correct implementation - credentials need
                  admin access because RLS restricts them by default.
  Verdict:        FALSE POSITIVE - code is correctly implemented.

----------------------------------------------------------------------

FP-02: SEC-C01 "PostgREST Filter Injection" (Audit 1)
  Original Claim: User query can inject arbitrary filter conditions
                  to expose inactive/deleted listings.
  Actual Code:    The .or() group is combined with outer AND
                  conditions (.eq("is_active", true), .is("deleted_at",
                  null)). Even if metacharacters inject extra OR
                  conditions, the outer AND filters still apply.
                  Data exposure is not possible.
  Actual Risk:    500 errors from malformed filter syntax (confirmed
                  by Codex audit). Reclassified as CRT-09 (crash
                  vector, not injection).
  Verdict:        PARTIALLY FALSE - not an injection, but IS a
                  crash vulnerability (captured separately).

----------------------------------------------------------------------

FP-03: API-H04 "No Input Validation on Auth Actions" (Audit 1)
  Original Claim: "FormData cast to string without validation.
                  Null becomes 'null'."
  Actual Code:    Supabase Auth handles password validation
                  server-side. The lack of client-side validation
                  is a UX issue, not a security vulnerability.
  Verdict:        PARTIALLY FALSE - downgraded from HIGH security
                  to DEF-06 (auth-only, UX concern).

----------------------------------------------------------------------

FP-04: INF-C04 "env:check Not in Build Pipeline" (Audit 1)
  Original Claim: env:check is manual only, not in build script.
  Actual Code:    env:check IS included in all verify:phase*
                  scripts. The build script itself is just
                  "next build" but that's standard - env validation
                  runs via verify:ci.
  Verdict:        PARTIALLY FALSE - env:check exists in the
                  verification pipeline, just not in bare "build".

----------------------------------------------------------------------

FP-05: INF-H10 Duplicate of CRT-12
  Original Claim: Listed as separate infra finding.
  Actual:         Same issue as CRT-12 (DM Sans not loaded).
                  Deduplicated.


=============================================
8. POSITIVE FINDINGS (What's Done Well)
=============================================

SECURITY:
  - RLS policies on ALL tables (1,068-line migration)
  - SECURITY DEFINER functions with search_path protection
  - Role escalation prevention trigger
  - Column-level GRANT restrictions on users table
  - Optimistic locking on bookings and leads
  - Idempotency key support for leads and messages
  - Contact info gated behind lead acceptance status
  - Redirect path sanitization (blocks //, .., newlines)
  - Good security headers (HSTS, X-Frame-Options, X-Content-Type)

CODE QUALITY:
  - TypeScript strict mode with ZERO any types
  - ZERO @ts-ignore or @ts-expect-error suppressions
  - Clean @/ path aliases throughout
  - Structured logger with JSON output for production
  - 13 comprehensive Zod schemas defined (need wiring)
  - Consistent ApiResponse<T> envelope pattern

TESTING:
  - 9 existing test files, all high quality
  - a11y assertions in UI tests (ARIA, focus trap, keyboard nav)
  - Auth routing tests cover open redirect prevention

ARCHITECTURE:
  - Clean separation of client/server/admin Supabase clients
  - Proper state machine for booking transitions
  - Well-structured database schema (39 tables, v1.4.0)
  - Good indexing strategy with composite/partial indexes
  - Soft delete pattern with deleted_at columns
  - CHECK constraints on business fields
  - Audit event table for compliance

LEGAL (Correct):
  - Disclaimer properly states "does not hold an AFSL"
  - Footer explains introducer vs advisor distinction
  - Footer links to ASIC Financial Advisers Register
  - Privacy Policy references Australian Privacy Principles
  - Terms of Service disclaims financial advice


=============================================
9. REMEDIATION ROADMAP
=============================================

----------------------------------------------------------------------
PHASE 0: IMMEDIATE - Legal + Trust (Day 1)
----------------------------------------------------------------------
Priority: MUST DO before any public traffic

  [ ] Remove ALL fabricated testimonials (CRT-01)
  [ ] Remove ALL fabricated statistics (CRT-02)
  [ ] Soften ASIC verification claims (CRT-03)
  [ ] Replace ABN placeholder with real ABN (CRT-04)
  [ ] Verify/replace contact details (CRT-05)
  [ ] Complete legal sign-off (CRT-06)
  [ ] Remove "Featured in: Forbes, WSJ, Bloomberg" (CRT-07)
  [ ] Fix dead links to pruned routes (CRT-10)
  [ ] Fix or remove fake contact form (CRT-11)
  [ ] Load DM Sans font via next/font (CRT-12)

----------------------------------------------------------------------
PHASE 1: SECURITY + ACCESSIBILITY - Days 2-3
----------------------------------------------------------------------
Priority: MUST DO before public launch

  [ ] Install @upstash/ratelimit + @upstash/redis (CRT-08)
  [ ] Sanitize listings search query input (CRT-09)
  [ ] Fix critical/serious accessibility violations (CRT-13)
  [ ] Apply Zod schemas to API route handlers (HI-01)
  [ ] Add UUID validation on [id] params (HI-02)
  [ ] Tighten CSP headers (HI-03)

----------------------------------------------------------------------
PHASE 2: INFRA + QUALITY - Days 4-7
----------------------------------------------------------------------
Priority: SHOULD DO before launch

  [ ] Add caching headers to public routes (HI-04)
  [ ] Fix guest lead orphan user problem (HI-05)
  [ ] Create robots.txt + sitemap.xml (HI-07, HI-08)
  [ ] Add Sentry error tracking (HI-09)
  [ ] Add OpenGraph + per-page metadata (HI-12)
  [ ] Move pg to devDependencies (HI-13)
  [ ] Add cookie consent banner (HI-14)
  [ ] Hide map toggle in search (MED-09)
  [ ] Fix CI instability (MED-16)

----------------------------------------------------------------------
PHASE 3: TESTING + HARDENING - Days 8-14
----------------------------------------------------------------------
Priority: SHOULD DO before or shortly after launch

  [ ] Write API route tests for critical paths (HI-10)
  [ ] Write E2E tests for search + lead flow (HI-11)
  [ ] Use generated types in Supabase queries (HI-06)
  [ ] Fix category taxonomy inconsistency (MED-11)
  [ ] Fix pagination counts (MED-02)
  [ ] Add CAPTCHA to lead form (MED-12)
  [ ] Add CSRF protection (MED-13)
  [ ] Sanitize error messages (MED-14)

----------------------------------------------------------------------
PHASE 4: POLISH + COMPLETENESS - Days 15-21
----------------------------------------------------------------------
Priority: CAN DO after soft launch

  [ ] Wire newsletter subscription (MED-03)
  [ ] Fix/remove non-functional buttons (MED-05, MED-06)
  [ ] Fix non-functional search/links on content pages (MED-07, MED-08)
  [ ] Fix fabricated stats inconsistencies (MED-10)
  [ ] Fix package name mismatch (MED-15)
  [ ] Clean up deprecated components (LOW-05, LOW-06)
  [ ] Add analytics platform


=============================================
10. DEFERRED ISSUES (Auth-Only, Out of MVP1 Scope)
=============================================

These issues affect only auth-gated routes (login, signup, dashboard,
admin, advisor portal) which are intentionally disabled via middleware
for MVP1. They should be resolved before enabling auth routes.

----------------------------------------------------------------------
FROM HIGH PRIORITY
----------------------------------------------------------------------

DEF-01: No Rate Limiting on Auth Endpoints
  Status:   CONFIRMED
  Evidence: authRatelimit defined in ratelimit.ts but NEVER
            imported in auth-actions.ts. signUp/signIn/
            resetPassword have zero rate limiting.
  Fix:      Import and call checkRateLimit() in each action.

DEF-02: No Middleware Session Refresh
  Status:   CONFIRMED
  Files:    site/src/middleware.ts (40 lines total)
  Evidence: Middleware only checks disabled routes. No Supabase
            session refresh, no CSRF validation.
  Fix:      Add session refresh when auth routes are enabled.

DEF-03: no_show Enum Mismatch in Bookings
  Status:   CONFIRMED
  Files:    site/src/app/api/bookings/route.ts:339
            database/schema.sql (booking_status enum)
  Evidence: Code references "no_show" but DB enum only has:
            proposed, confirmed, cancelled, completed.
  Fix:      Either add no_show to enum or remove from code.

DEF-04: N+1 Queries in Consumer Dashboard
  Status:   CONFIRMED (partially mitigated)
  Files:    site/src/app/api/dashboard/consumer/route.ts
  Evidence: 10+ sequential queries. Leads fetched twice
            (lines 128-131 and 149-152).
  Fix:      Combine duplicate queries. Consider DB view.

DEF-05: Conversations Fetches ALL Messages
  Status:   CONFIRMED
  Files:    site/src/app/api/conversations/route.ts:179-183
  Evidence: No .limit() on message query. Fetches all messages
            across conversations to find last per conversation.
  Fix:      Add LIMIT or use DB window function.

DEF-06: No Input Validation on Auth Actions
  Status:   PARTIALLY CORRECT
  Files:    site/src/lib/auth-actions.ts
  Evidence: Email/password extracted from FormData without
            server-side validation. Supabase handles password
            rules server-side, but no email format check.
  Fix:      Add Zod validation before Supabase calls.

----------------------------------------------------------------------
FROM MEDIUM
----------------------------------------------------------------------

DEF-07: Booking Hardcoded to Australia/Sydney
  Files:    site/src/app/api/bookings/route.ts:508
  Evidence: Perth users get 2-3 hour discrepancies.

DEF-08: hasUnreadMessages Hardcoded to false
  Files:    site/src/app/api/requests/route.ts
  Evidence: Always returns false regardless of message state.

DEF-09: No Server-Side Password Strength Enforcement
  Files:    site/src/lib/auth-actions.ts
  Evidence: Password passed directly to Supabase without
            server-side complexity checks.

DEF-10: Email Enumeration via Auth Error Messages
  Evidence: Different errors for existing vs non-existing emails.


=============================================
11. SOURCE COVERAGE RECONCILIATION
=============================================

Purpose: Ensure every item from both source audits is explicitly
accounted for in this validated document.

Coverage statuses used:
  - MAPPED: direct one-to-one mapping to CRT/HI/MED/LOW/DEF/FP
  - CONSOLIDATED: merged into a broader validated item
  - DEFERRED: out of MVP1 scope (auth/dashboard/admin only)
  - REJECTED: validated false positive
  - OPERATIONS BACKLOG: launch ops task (not a code defect)

----------------------------------------------------------------------
A) RELEASE_READINESS_AUDIT_2026-02-11.md COVERAGE (10/10)
----------------------------------------------------------------------

  B1  Legal placeholders (ABN)                     -> MAPPED (CRT-04)
  B2  Legal/compliance pending sign-off            -> MAPPED (CRT-06)
  B3  Dead links to pruned routes                  -> MAPPED (CRT-10)
  B4  Contact form simulated                       -> MAPPED (CRT-11)
  B5  Unverifiable trust/press claims              -> MAPPED (CRT-01/02/03/07)
  B6  Listings API crafted-query 500               -> MAPPED (CRT-09)
  B7  Fail-open rate limiting                       -> MAPPED (CRT-08)
  B8  Critical/serious accessibility failures       -> MAPPED (CRT-13)
  B9  Map toggle exposes "coming soon"             -> MAPPED (MED-09)
  B10 CI instability                                -> MAPPED (MED-16)

----------------------------------------------------------------------
B) PRODUCTION_READINESS_AUDIT ITEMS NOT PREVIOUSLY EXPLICIT
   IN SECTIONS 3-10 (NOW ACCOUNTED FOR HERE)
----------------------------------------------------------------------

SECURITY / API:
  SEC-C04  User role controllable at signup        -> DEFERRED (auth-only;
                                                      related to DEF-06 auth actions)
  SEC-L05  Sensitive data in client console logs   -> OPERATIONS BACKLOG (no confirmed
                                                      PII leakage on MVP1 public routes;
                                                      review when auth routes enabled)
  API-H08  Missing env var validation              -> MAPPED (LOW-03: Non-null
                                                      assertions on env vars)
  API-M07  Missing search_vector / FTS             -> CONSOLIDATED (MED-11 taxonomy
                                                      and search quality backlog)

UI / UX:
  UI-P1-01 Header missing "Resources" nav link     -> CONSOLIDATED (navigation polish;
                                                      non-blocking MVP1 UX item)
  UI-P1-02 Header missing "Log in" link            -> DEFERRED (auth route pruned for MVP1)
  UI-P2-03 Search pagination uses href="#"         -> CONSOLIDATED (MED-02 pagination +
                                                      MED-06 decorative controls)

INFRA / DEPLOYMENT:
  INF-H02  No analytics platform                   -> CONSOLIDATED (Roadmap Phase 4:
                                                      "Add analytics platform")
  INF-H03  No health check endpoint                -> OPERATIONS BACKLOG
  INF-M02  Upstash env vars not in env:check       -> CONSOLIDATED (CRT-08 rate limit setup)
  INF-M03  No vercel.json                          -> OPERATIONS BACKLOG
  INF-M04  No images.remotePatterns                -> OPERATIONS BACKLOG
  INF-M05  CI missing Supabase env vars            -> CONSOLIDATED (MED-16 CI instability)
  INF-M06  No deployment automation (CD)           -> OPERATIONS BACKLOG
  INF-M07  No web app manifest                     -> OPERATIONS BACKLOG
  INF-M08  Basic favicon only                      -> OPERATIONS BACKLOG
  INF-M09  Logger has no request IDs               -> OPERATIONS BACKLOG
  INF-L01  --webpack in build script               -> OPERATIONS BACKLOG
  INF-L03  .env.example confusing                  -> OPERATIONS BACKLOG
  INF-L05  Playwright mobile viewports commented   -> OPERATIONS BACKLOG
  INF-L06  Default Next.js boilerplate SVGs        -> OPERATIONS BACKLOG

QUALITY:
  QA-M03   Email addresses scattered across 8+ files -> CONSOLIDATED (CRT-05 placeholder
                                                      contact details covers centralizing
                                                      contact info)
  QA-M04   ESLint has no custom rules              -> OPERATIONS BACKLOG

Additional deferred auth-only API items referenced in
PRODUCTION_READINESS_AUDIT Section 11 are accounted for under the
DEF-* group in Section 10 of this document as scoped deferments.

----------------------------------------------------------------------
C) OPERATIONS BACKLOG (NON-DEFECT LAUNCH TASKS FROM SOURCE ROADMAP)
----------------------------------------------------------------------

The following roadmap tasks from PRODUCTION_READINESS_AUDIT are now
explicitly tracked here as launch operations prerequisites (not code
defects):

  OPS-01  Configure production Supabase instance
  OPS-02  Configure Vercel production deployment
  OPS-03  Seed production DB with real advisor records
  OPS-04  Execute manual QA walkthrough on all 19 MVP1 routes
  OPS-05  Run staging deployment + smoke verification before go-live


=============================================
SCORING SUMMARY
=============================================

  Category               Confirmed    FP/Rejected
  -----------------------------------------------
  Critical Blockers      13           --
  High Priority          14           --
  Medium                 16           --
  Low                    15           --
  Deferred (Auth-Only)   10           --
  False Positives        --            5
  -----------------------------------------------
  Total Valid Issues     68
  Total Rejected          5

MVP1 Minimum Launch Gate: Clear Phase 0 + Phase 1 (16 items)
Full Production Ready:   Clear all phases + deferred (68 items)


=============================================
END OF VALIDATED AUDIT
=============================================

Generated:  2026-02-12
Method:     Cross-validation of 2 independent audits
            4 parallel validation agents
            Direct source code verification
Verdict:    NOT READY - 13 critical blockers remain
